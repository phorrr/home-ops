---
# Simplified Cilium configuration for k3d (containerized) environment
# Disables bare-metal features that can interfere with Docker networking

bpf:
  masquerade: true

cni:
  exclusive: false

# Disable Hubble (observability) for simpler k3d setup
hubble:
  enabled: false
  ui:
    enabled: false
  relay:
    enabled: false

# Point to k3d API server
k8sServiceHost: 127.0.0.1
k8sServicePort: 6443

# Basic kube-proxy replacement (works in k3d)
kubeProxyReplacement: true
kubeProxyReplacementHealthzBindAddr: REDACTED_PUBLIC_IP:10256

# Disable bare-metal networking features
bgpControlPlane:
  enabled: false  # BGP requires physical network access
l2announcements:
  enabled: false  # L2 announcements require host network control

localRedirectPolicy: true

operator:
  dashboards:
    enabled: false
  prometheus:
    enabled: false
    serviceMonitor:
      enabled: false
  replicas: 1
  rollOutPods: true

# Disable PMTU discovery in containerized environment
pmtuDiscovery:
  enabled: false

prometheus:
  enabled: false
  serviceMonitor:
    enabled: false
    trustCRDsExist: false

dashboards:
  enabled: false

# Use Kubernetes IPAM (simple and works well in k3d)
ipam:
  mode: kubernetes

# Tunnel mode is appropriate for k3d
routingMode: tunnel

enableIPv4BIGTCP: false

endpointRoutes:
  enabled: true

# Disable Envoy and Gateway API for simpler setup
envoy:
  enabled: false
gatewayAPI:
  enabled: false

# Socket LB not needed in k3d environment
socketLB:
  enabled: false
