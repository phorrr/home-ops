---
k3s_cluster:
  children:
    controllers:
      children:
        bd795:
          hosts:
            k3s-bd795-1:
              ansible_host: REDACTED_PRIVATE_IP
            k3s-bd795-2:
              ansible_host: REDACTED_PRIVATE_IP
          vars:
            k3s_server_node_labels:
              - topology.kubernetes.io/zone=home
              - hardwaretype=bd795
              - amd.feature.node.kubernetes.io/gpu=true
              - kata-containers=enabled
            zfs_disks:
              - /dev/nvme0n1
        epyc:
          hosts:
            k3s-epyc:
              ansible_host: REDACTED_PRIVATE_IP
          vars:
            k3s_server_node_labels:
              - topology.kubernetes.io/zone=home
              - hardwaretype=epyc
              - kata-containers=enabled
            zfs_disks:
              - /dev/vdb
      vars:
        enable_zfs: true
        enable_network_tuning: true
        k3s_control_node: true
        k3s_etcd_datastore: true
        k3s_install_hard_links: true
        k3s_become: true
        k3s_release_version: v1.33.2+k3s1
        k3s_skip_validation: true
        k3s_server_manifests_templates:
          - "{{ lookup('env', 'ROOT_DIR') }}/bootstrap/home-k3s/manifests/kubevip-rbac.yaml"
          - "{{ lookup('env', 'ROOT_DIR') }}/bootstrap/home-k3s/manifests/kubevip.yaml"
          - "{{ lookup('env', 'ROOT_DIR') }}/bootstrap/home-k3s/manifests/prometheus-operator-crd.yaml"
        k3s_server:
          node-name: "{{ inventory_hostname }}"
          flannel-backend: "none"
          cluster-cidr: 10.30.0.0/16
          service-cidr: 10.31.0.0/16
          disable-kube-proxy: true
          disable-network-policy: true
          disable:
            - coredns
            - local-storage
            - metrics-server
            - servicelb
            - traefik
          kube-apiserver-arg:
            - "feature-gates=MutatingAdmissionPolicy=true"
            - "runtime-config=admissionregistration.k8s.io/v1alpha1=true"
          tls-san:
            - "REDACTED_DOMAIN"
            - "{{ lookup('env', 'API_ENDPOINT') }}"
          write-kubeconfig-mode: "0644"
          # This will be combined with specific node labels from child groups
          node-label: "{{ k3s_server_node_labels | default([]) }}"
unraid_k3d_clusters:
  hosts:
    unraid-zapp:
      ansible_host: REDACTED_DOMAIN
      k3d_cluster_name: zapp-k3d
      k3d_config_dir: /mnt/user/appdata/k3d-zapp
      k3d_storage_dir: /mnt/user/appdata/k3d-zapp/storage
      k3d_data_dir: /mnt/user/appdata/k3d-zapp/data
      k3d_http_port: 80
      k3d_https_port: 443
    unraid-offsite:
      ansible_host: REDACTED_DOMAIN
      k3d_cluster_name: offsite-k3d
      k3d_config_dir: /mnt/user/appdata/k3d-offsite
      k3d_storage_dir: /mnt/user/appdata/k3d-offsite/storage
      k3d_data_dir: /mnt/user/appdata/k3d-offsite/data
      k3d_http_port: 80
      k3d_https_port: 443
  vars:
    ansible_user: root
    ansible_python_interpreter: /usr/bin/python3
    k3d_version: "5.8.3"
    k3d_k3s_version: "v1.34.1-k3s1"
    kubectl_version: "1.34.0"
    flux_version: "2.7.0"
